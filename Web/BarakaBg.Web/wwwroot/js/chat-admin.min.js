(async function(){async function t(){try{await n.start();await n.invoke("LoadRooms")}catch(i){console.error(i);setTimeout(t,5e3)}}function r(t){var i="",r;i+='<div class="chat_list"id="'+t.id+'">';i+='    <div class="chat_people">';i+='        <div class="chat_ib">';i+="            <h5>"+t.ownerUsername+' <span class="chat_date"><time datetime="'+t.createdOn+'"><\/time><\/span><\/h5>';i+="            <p>"+f(t.lastMessage)+" <\/p>";i+="        <\/div>";i+="    <\/div>";i+="<\/div>";$(".inbox_chat").append(i);jQuery.parseTime();r=document.querySelector(`[id="${t.id}"]`);r.addEventListener("click",async function(){for(var u=document.querySelectorAll(".chat_list"),i=0;i<u.length;i++)u[i].classList.remove("active_chat");r.classList.add("active_chat");await n.invoke("LoadRoomMessages",t.id)})}function u(n){var t="";n.isByRoomOwner?(t+='<div class="incoming_msg">',t+='    <div class="received_msg">',t+='    <div class="received_withd_msg">'):(t+='<div class="outgoing_msg">',t+='    <div class="sent_msg">');t+="        <p>"+f(n.message)+"<\/p>";t+='            <span class="time_date"><time datetime="'+n.createdOn+'"><\/time> By: '+n.senderUsername+"<\/span>";t+="    <\/div>";t+="<\/div>";$(".msg_history").append(t);jQuery.parseTime();$(".msg_history").stop().animate({scrollTop:$(".msg_history")[0].scrollHeight},1e3)}function f(n){return n==null?n:n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var n=(new signalR.HubConnectionBuilder).withUrl("/chat").build(),i;n.onclose(t);t();n.on("NewRoom",function(n){if(Array.isArray(n)){document.querySelector(".inbox_chat").innerHTML="";for(var t=0;t<n.length;t++)r(n[t])}else r(n)});n.on("NewMessage",function(n){if(Array.isArray(n)){document.querySelector(".msg_history").innerHTML="";for(var t=0;t<n.length;t++)u(n[t])}else u(n)});i=document.querySelector(".msg_send_btn");i.addEventListener("click",async function(t){var i,r;if(t.preventDefault(),i=document.querySelector(".write_msg").value,i.trim()=="")return!1;$(".write_msg").val("");r=document.querySelector(".active_chat").getAttribute("id");await n.invoke("SendToRoom",r,i)})})();